<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mega Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background-color: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; touch-action: none; }
        canvas { border-radius: 0px; }
    </style>
</head>
<body>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();

    let score = 0;
    let clickPower = 1;
    let autoClickRate = 0;
    let upgradeClickCost = 15;
    let upgradeAutoCost = 25;

    let scoreText, infoText, btnClick, btnAuto, txtClick, txtAuto;

    function saveGame() {
        const data = { score, clickPower, autoClickRate, upgradeClickCost, upgradeAutoCost };
        localStorage.setItem('clickerSaveData', JSON.stringify(data));
    }

    function loadGame() {
        const saved = localStorage.getItem('clickerSaveData');
        if (saved) {
            const d = JSON.parse(saved);
            score = d.score || 0;
            clickPower = d.clickPower || 1;
            autoClickRate = d.autoClickRate || 0;
            upgradeClickCost = d.upgradeClickCost || 15;
            upgradeAutoCost = d.upgradeAutoCost || 25;
        }
    }

    const config = {
        type: Phaser.AUTO,
        width: 400,
        height: 600,
        scene: { preload: preload, create: create }
    };

    const game = new Phaser.Game(config);

    function preload() {
        // Убедись, что файлы лежат в корне репозитория рядом с index.html
        this.load.image('bg', 'bg.jpg');
        this.load.image('hero', 'soldier.png');
    }

    function create() {
        loadGame();

        let background = this.add.image(200, 300, 'bg');
        background.setDisplaySize(400, 600);

        const textStyle = { fontSize: '32px', fill: '#fff', fontFamily: 'Arial Black' };
        scoreText = this.add.text(20, 20, '', textStyle).setStroke('#000', 6);
        infoText = this.add.text(20, 70, '', { fontSize: '16px', fill: '#fff' }).setStroke('#000', 4);

        const hero = this.add.sprite(200, 280, 'hero').setInteractive();
        
        hero.on('pointerdown', (pointer) => {
            score += clickPower;
            updateUI();
            
            // Вибрация для Telegram
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');

            this.tweens.add({ targets: hero, scale: 1.1, duration: 50, yoyo: true });
            showClickText(this, pointer.x, pointer.y, `+${clickPower}`, '#fff');
        });

        // Кнопки магазина
        btnClick = this.add.rectangle(200, 480, 340, 60, 0x3498db).setInteractive();
        txtClick = this.add.text(200, 480, '', { fontSize: '16px', fill: '#fff' }).setOrigin(0.5);

        btnClick.on('pointerdown', () => {
            if (score >= upgradeClickCost) {
                score -= upgradeClickCost;
                clickPower += 1;
                upgradeClickCost = Math.floor(upgradeClickCost * 1.8);
                saveGame();
                updateUI();
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            } else { shakeButton(this, btnClick); }
        });

        btnAuto = this.add.rectangle(200, 550, 340, 60, 0x2ecc71).setInteractive();
        txtAuto = this.add.text(200, 550, '', { fontSize: '16px', fill: '#fff' }).setOrigin(0.5);

        btnAuto.on('pointerdown', () => {
            if (score >= upgradeAutoCost) {
                score -= upgradeAutoCost;
                autoClickRate += 1;
                upgradeAutoCost = Math.floor(upgradeAutoCost * 1.6);
                saveGame();
                updateUI();
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            } else { shakeButton(this, btnAuto); }
        });

        this.time.addEvent({
            delay: 1000,
            callback: () => {
                if (autoClickRate > 0) {
                    score += autoClickRate;
                    updateUI();
                    showClickText(this, 200, 200, `+${autoClickRate}`, '#f1c40f');
                }
            },
            loop: true
        });

        updateUI();
    }

    function updateUI() {
        scoreText.setText('Очки: ' + Math.floor(score));
        infoText.setText(`Сила клика: ${clickPower}\nАвтоклик: ${autoClickRate}/сек`);
        txtClick.setText(`Улучшить клик (Цена: ${upgradeClickCost})`);
        txtAuto.setText(`Купить автоклик (Цена: ${upgradeAutoCost})`);
    }

    function showClickText(scene, x, y, text, color) {
        const t = scene.add.text(x, y, text, { fontSize: '28px', fill: color, fontFamily: 'Arial Black' }).setOrigin(0.5).setStroke('#000', 4);
        scene.tweens.add({ targets: t, y: y - 100, alpha: 0, duration: 800, onComplete: () => t.destroy() });
    }

    function shakeButton(scene, button) {
        scene.cameras.main.shake(100, 0.005);
        button.setFillStyle(0xe74c3c);
        scene.time.delayedCall(200, () => {
            button.setFillStyle(button === btnClick ? 0x3498db : 0x2ecc71);
        });
    }
</script>
</body>
</html>
