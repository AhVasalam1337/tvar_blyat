<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #1a1a1a; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
<script>
    // 1. Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¢ÐµÐ»ÐµÐ³Ñ€Ð°Ð¼
    const tg = window.Telegram.WebApp;
    tg.expand();

    // 2. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¸Ð³Ñ€Ñ‹
    let score = 0;
    let clickPower = 1;
    let autoClickRate = 0;
    let upgradeClickCost = 15;
    let upgradeAutoCost = 25;
    let isShopOpen = false;

    const config = {
        type: Phaser.AUTO,
        width: window.innerWidth,
        height: window.innerHeight,
        backgroundColor: '#1a1a1a',
        parent: document.body,
        scene: { preload: preload, create: create }
    };

    const game = new Phaser.Game(config);

    function preload() {
        // ÐŸÑ€Ð¾ÐºÑÐ¸ Ð´Ð»Ñ ÐºÐ°Ñ€Ñ‚Ð¸Ð½Ð¾Ðº
        const p = "https://wsrv.nl/?url=";
        this.load.image('bg', p + "https://i.imgur.com/VbrseLE.jpeg");
        this.load.image('hero', p + "https://i.imgur.com/FObb0sw.png");
    }

    function create() {
        const scene = this;

        // Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐµÐ¹Ð²Ð¾Ð²
        const saved = localStorage.getItem('cyberSave');
        if(saved) {
            const d = JSON.parse(saved);
            score = d.score || 0;
            clickPower = d.clickPower || 1;
            autoClickRate = d.autoClickRate || 0;
            upgradeClickCost = d.upgradeClickCost || 15;
            upgradeAutoCost = d.upgradeAutoCost || 25;
        }

        // Ð¤Ð¾Ð½ Ð½Ð° Ð²ÐµÑÑŒ ÑÐºÑ€Ð°Ð½
        let bg = scene.add.image(scene.cameras.main.centerX, scene.cameras.main.centerY, 'bg');
        let scaleX = scene.cameras.main.width / bg.width;
        let scaleY = scene.cameras.main.height / bg.height;
        let scale = Math.max(scaleX, scaleY);
        bg.setScale(scale).setScrollFactor(0);

        // Ð“ÐµÑ€Ð¾Ð¹
        const hero = scene.add.sprite(scene.cameras.main.centerX, scene.cameras.main.centerY, 'hero').setInteractive();
        hero.setScale(0.8);

        // Ð¢ÐµÐºÑÑ‚Ñ‹
        const scoreText = scene.add.text(20, 40, 'ÐžÑ‡ÐºÐ¸: 0', { fontSize: '28px', fill: '#fff', stroke: '#000', strokeThickness: 4 });
        const infoText = scene.add.text(20, 80, '', { fontSize: '14px', fill: '#00ffcc' });

        // ÐœÐ°Ð³Ð°Ð·Ð¸Ð½ (Ð³Ñ€ÑƒÐ¿Ð¿Ð°)
        const shopLayer = scene.add.container(0, 0).setDepth(100).setVisible(false);
        const overlay = scene.add.rectangle(0, 0, scene.cameras.main.width * 2, scene.cameras.main.height * 2, 0x000000, 0.8).setInteractive();
        const menuBg = scene.add.rectangle(scene.cameras.main.centerX, scene.cameras.main.centerY, 300, 350, 0x222222).setStroke('#00ffcc', 2);
        const closeTxt = scene.add.text(scene.cameras.main.centerX + 120, scene.cameras.main.centerY - 160, 'âœ•', { fontSize: '30px' }).setInteractive();
        
        const btn1 = scene.add.rectangle(scene.cameras.main.centerX, scene.cameras.main.centerY - 40, 250, 60, 0x333333).setInteractive();
        const t1 = scene.add.text(scene.cameras.main.centerX, scene.cameras.main.centerY - 40, '', { fontSize: '14px' }).setOrigin(0.5);

        const btn2 = scene.add.rectangle(scene.cameras.main.centerX, scene.cameras.main.centerY + 40, 250, 60, 0x333333).setInteractive();
        const t2 = scene.add.text(scene.cameras.main.centerX, scene.cameras.main.centerY + 40, '', { fontSize: '14px' }).setOrigin(0.5);

        shopLayer.add([overlay, menuBg, closeTxt, btn1, t1, btn2, t2]);

        // ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
        const shopIcon = scene.add.text(scene.cameras.main.width - 60, 50, 'ðŸ›’', { fontSize: '40px' }).setInteractive();

        // Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸
        const updateUI = () => {
            scoreText.setText('ÐžÑ‡ÐºÐ¸: ' + Math.floor(score));
            infoText.setText(`Ð¢Ð°Ð¿: +${clickPower} | ÐÐ²Ñ‚Ð¾: ${autoClickRate}/Ñ`);
            t1.setText(`Ð£Ð»ÑƒÑ‡ÑˆÐ¸Ñ‚ÑŒ Ñ‚Ð°Ð¿: ${upgradeClickCost}`);
            t2.setText(`ÐÐ²Ñ‚Ð¾-ÐºÐ»Ð¸ÐºÐµÑ€: ${upgradeAutoCost}`);
        };

        hero.on('pointerdown', () => {
            if(isShopOpen) return;
            score += clickPower;
            scene.tweens.add({ targets: hero, scale: 0.75, duration: 50, yoyo: true });
            updateUI();
            if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
        });

        shopIcon.on('pointerdown', () => { isShopOpen = true; shopLayer.setVisible(true); });
        closeTxt.on('pointerdown', () => { isShopOpen = false; shopLayer.setVisible(false); });

        btn1.on('pointerdown', () => {
            if(score >= upgradeClickCost) {
                score -= upgradeClickCost; clickPower++; upgradeClickCost *= 2; updateUI();
            }
        });

        btn2.on('pointerdown', () => {
            if(score >= upgradeAutoCost) {
                score -= upgradeAutoCost; autoClickRate++; upgradeAutoCost *= 2; updateUI();
            }
        });

        scene.time.addEvent({ delay: 1000, callback: () => { score += autoClickRate; updateUI(); }, loop: true });
        
        updateUI();
    }
</script>
</body>
</html>
