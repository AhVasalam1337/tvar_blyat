<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #1a1a1a; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        canvas { display: block; }
    </style>
</head>
<body>
<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let score = 0;
    let clickPower = 1;
    let autoClickRate = 0;
    let upgradeClickCost = 15;
    let upgradeAutoCost = 25;
    let isShopOpen = false;

    let scoreText, infoText, txtClick, txtAuto, shopLayer;

    const config = {
        type: Phaser.AUTO,
        width: 400,
        height: 600,
        backgroundColor: '#1a1a1a',
        scene: { preload: preload, create: create }
    };

    const game = new Phaser.Game(config);

    function preload() {
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ —Ç–≤–æ–µ–≥–æ GitHub
        // –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–∞–π–ª—ã –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –∏–º–µ–Ω–Ω–æ —Ç–∞–∫: bg.png –∏ hero.png
        this.load.image('bg', 'bg.jpg');
        this.load.image('hero', 'soldier.png');
    }

    function create() {
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–π–≤–æ–≤ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
        const saved = localStorage.getItem('cyberClickerSave');
        if(saved) {
            const d = JSON.parse(saved);
            score = d.score || 0;
            clickPower = d.clickPower || 1;
            autoClickRate = d.autoClickRate || 0;
            upgradeClickCost = d.upgradeClickCost || 15;
            upgradeAutoCost = d.upgradeAutoCost || 25;
        }

        // 1. –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ñ–æ–Ω–∞
        const background = this.add.image(200, 300, 'bg');
        background.setDisplaySize(400, 600);

        // 2. –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥–µ—Ä–æ—è
        const hero = this.add.sprite(200, 320, 'hero').setInteractive();
        hero.setDisplaySize(280, 280);

        // –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è (–ª–µ–≤–∏—Ç–∞—Ü–∏—è)
        this.tweens.add({
            targets: hero,
            y: 335,
            duration: 2000,
            yoyo: true,
            repeat: -1,
            ease: 'Sine.easeInOut'
        });

        // 3. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–û—á–∫–∏ –∏ –∏–Ω—Ñ–æ)
        scoreText = this.add.text(20, 30, '', { fontSize: '36px', fill: '#fff', fontFamily: 'Arial Black' }).setStroke('#000', 6);
        infoText = this.add.text(20, 80, '', { fontSize: '16px', fill: '#00ffcc', fontFamily: 'Arial' }).setStroke('#000', 4);

        // –õ–æ–≥–∏–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –≥–µ—Ä–æ—é
        hero.on('pointerdown', (pointer) => {
            if (isShopOpen) return;
            score += clickPower;
            updateUI();
            
            // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è
            this.tweens.add({ targets: hero, scale: 0.85, duration: 50, yoyo: true });
            
            // –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —á–∏—Å–ª–æ –æ—á–∫–æ–≤
            const t = this.add.text(pointer.x, pointer.y, `+${clickPower}`, { fontSize: '24px', fill: '#00ffcc', fontFamily: 'Arial Black' }).setOrigin(0.5);
            this.tweens.add({ targets: t, y: pointer.y - 100, alpha: 0, duration: 800, onComplete: () => t.destroy() });

            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            saveGame();
        });

        // 4. –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        const shopBtn = this.add.rectangle(350, 55, 60, 60, 0x000000, 0.6).setInteractive();
        this.add.text(350, 55, 'üõí', { fontSize: '35px' }).setOrigin(0.5);

        // 5. –°–û–ó–î–ê–ù–ò–ï –ú–ê–ì–ê–ó–ò–ù–ê (–°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
        shopLayer = this.add.container(0, 0).setDepth(100).setVisible(false);
        
        const overlay = this.add.rectangle(200, 300, 400, 600, 0x000000, 0.85).setInteractive();
        const menuBg = this.add.rectangle(200, 300, 320, 380, 0x1a1a1a).setStroke('#00ffcc', 2);
        const closeBtn = this.add.text(330, 130, '‚úï', { fontSize: '32px', fill: '#fff' }).setInteractive();
        const shopTitle = this.add.text(200, 160, '–ö–ò–ë–ï–†-–õ–ê–í–ö–ê', { fontSize: '28px', fill: '#00ffcc', fontFamily: 'Arial Black' }).setOrigin(0.5);

        // –ö–Ω–æ–ø–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π
        const btn1 = this.add.rectangle(200, 260, 280, 70, 0x333333).setInteractive().setStroke('#3498db', 2);
        txtClick = this.add.text(200, 260, '', { fontSize: '16px', fill: '#fff', align: 'center' }).setOrigin(0.5);

        const btn2 = this.add.rectangle(200, 350, 280, 70, 0x333333).setInteractive().setStroke('#2ecc71', 2);
        txtAuto = this.add.text(200, 350, '', { fontSize: '16px', fill: '#fff', align: 'center' }).setOrigin(0.5);

        shopLayer.add([overlay, menuBg, closeBtn, shopTitle, btn1, txtClick, btn2, txtAuto]);

        // –°–æ–±—ã—Ç–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        shopBtn.on('pointerdown', () => { 
            isShopOpen = true; 
            shopLayer.setVisible(true); 
            updateUI(); 
        });
        
        closeBtn.on('pointerdown', () => { 
            isShopOpen = false; 
            shopLayer.setVisible(false); 
        });

        btn1.on('pointerdown', () => {
            if (score >= upgradeClickCost) {
                score -= upgradeClickCost;
                clickPower++;
                upgradeClickCost = Math.floor(upgradeClickCost * 1.8);
                updateUI(); saveGame();
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            }
        });

        btn2.on('pointerdown', () => {
            if (score >= upgradeAutoCost) {
                score -= upgradeAutoCost;
                autoClickRate++;
                upgradeAutoCost = Math.floor(upgradeAutoCost * 1.6);
                updateUI(); saveGame();
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            }
        });

        // –¢–∞–π–º–µ—Ä –∞–≤—Ç–æ–∫–ª–∏–∫–∞
        this.time.addEvent({ delay: 1000, callback: () => { score += autoClickRate; updateUI(); }, loop: true });

        updateUI();
    }

    function updateUI() {
        scoreText.setText(Math.floor(score));
        infoText.setText(`–¢–ê–ü: +${clickPower} | –ê–í–¢–û: ${autoClickRate}/—Å`);
        txtClick.setText(`–°–ò–õ–ê –ü–ê–õ–¨–¶–ê\n–¶–µ–Ω–∞: ${upgradeClickCost}`);
        txtAuto.setText(`–î–†–û–ù-–ü–û–ú–û–©–ù–ò–ö\n–¶–µ–Ω–∞: ${upgradeAutoCost}`);
    }

    function saveGame() {
        localStorage.setItem('cyberClickerSave', JSON.stringify({
            score, clickPower, autoClickRate, upgradeClickCost, upgradeAutoCost
        }));
    }
</script>
</body>
</html>
