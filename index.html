<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background-color: #1a1a1a; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
    </style>
</head>
<body>
<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let score = 0;
    let clickPower = 1;
    let autoClickRate = 0;
    let upgradeClickCost = 15;
    let upgradeAutoCost = 25;
    let isShopOpen = false;
    let scoreText, infoText, txtClick, txtAuto, shopLayer;

    const config = {
        type: Phaser.AUTO,
        width: 400,
        height: 600,
        backgroundColor: '#1a1a1a',
        scene: { preload: preload, create: create }
    };

    const game = new Phaser.Game(config);

    function preload() {
        // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÑÐµÑ€Ð²Ð¸Ñ wsrv.nl Ð´Ð»Ñ Ð¾Ð±Ñ…Ð¾Ð´Ð° Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð¾Ðº Imgur (CORS)
        const proxy = "https://wsrv.nl/?url=";
        const bgUrl = "https://i.imgur.com/VbrseLE.jpeg";
        const heroUrl = "https://i.imgur.com/FObb0sw.png";

        this.load.image('bg', proxy + bgUrl);
        this.load.image('hero', proxy + heroUrl);
        
        // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸
        this.load.on('loaderror', (file) => {
            console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ„Ð°Ð¹Ð»Ð°:', file.src);
        });
    }

    function create() {
        // Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ð¹
        const saved = localStorage.getItem('cyberClickerSave');
        if(saved) {
            const d = JSON.parse(saved);
            score = d.score || 0;
            clickPower = d.clickPower || 1;
            autoClickRate = d.autoClickRate || 0;
            upgradeClickCost = d.upgradeClickCost || 15;
            upgradeAutoCost = d.upgradeAutoCost || 25;
        }

        // Ð¤Ð¾Ð½ (ÐµÑÐ»Ð¸ Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑÑ - Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ñ‚ÐµÐ¼Ð½Ñ‹Ð¹ ÑÐºÑ€Ð°Ð½)
        if (this.textures.exists('bg')) {
            this.add.image(200, 300, 'bg').setDisplaySize(400, 600);
        }

        // Ð“ÐµÑ€Ð¾Ð¹
        const hero = this.add.sprite(200, 320, 'hero').setInteractive();
        if (this.textures.exists('hero')) {
            hero.setDisplaySize(250, 250);
        } else {
            // Ð•ÑÐ»Ð¸ Ð³ÐµÑ€Ð¾Ð¹ Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ð»ÑÑ, Ñ€Ð¸ÑÑƒÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚
            hero.setTexture('__WHITE');
            hero.setDisplaySize(100, 100);
            hero.setTint(0x00ffcc);
        }

        this.tweens.add({ targets: hero, y: 335, duration: 2000, yoyo: true, repeat: -1, ease: 'Sine.easeInOut' });

        scoreText = this.add.text(20, 25, '', { fontSize: '32px', fill: '#fff', fontFamily: 'Arial Black' }).setStroke('#000', 6);
        infoText = this.add.text(20, 75, '', { fontSize: '14px', fill: '#00ffcc', fontFamily: 'Arial' }).setStroke('#000', 4);

        hero.on('pointerdown', (pointer) => {
            if (isShopOpen) return;
            score += clickPower;
            updateUI();
            this.tweens.add({ targets: hero, scale: 0.95, duration: 50, yoyo: true });
            showClickText(this, pointer.x, pointer.y, `+${clickPower}`);
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            saveGame();
        });

        // ÐšÐÐžÐŸÐšÐ ÐœÐÐ“ÐÐ—Ð˜ÐÐ
        const shopBtn = this.add.rectangle(350, 50, 60, 60, 0x000000, 0.6).setInteractive();
        this.add.text(350, 50, 'ðŸ›’', { fontSize: '30px' }).setOrigin(0.5);

        shopLayer = this.add.container(0, 0).setDepth(100).setVisible(false);
        const overlay = this.add.rectangle(200, 300, 400, 600, 0x000000, 0.85).setInteractive();
        const menuBg = this.add.rectangle(200, 300, 320, 380, 0x1a1a1a).setStroke('#00ffcc', 2);
        const closeBtn = this.add.text(330, 140, 'âœ•', { fontSize: '28px', fill: '#fff' }).setInteractive();
        
        const btn1 = this.add.rectangle(200, 260, 280, 70, 0x333333).setInteractive().setStroke('#3498db', 2);
        txtClick = this.add.text(200, 260, '', { fontSize: '14px', fill: '#fff', align: 'center' }).setOrigin(0.5);

        const btn2 = this.add.rectangle(200, 360, 280, 70, 0x333333).setInteractive().setStroke('#2ecc71', 2);
        txtAuto = this.add.text(200, 360, '', { fontSize: '14px', fill: '#fff', align: 'center' }).setOrigin(0.5);

        shopLayer.add([overlay, menuBg, closeBtn, btn1, txtClick, btn2, txtAuto]);

        shopBtn.on('pointerdown', () => { isShopOpen = true; shopLayer.setVisible(true); updateUI(); });
        closeBtn.on('pointerdown', () => { isShopOpen = false; shopLayer.setVisible(false); });

        btn1.on('pointerdown', () => {
            if (score >= upgradeClickCost) {
                score -= upgradeClickCost;
                clickPower++;
                upgradeClickCost = Math.floor(upgradeClickCost * 1.7);
                updateUI(); saveGame();
            }
        });

        btn2.on('pointerdown', () => {
            if (score >= upgradeAutoCost) {
                score -= upgradeAutoCost;
                autoClickRate++;
                upgradeAutoCost = Math.floor(upgradeAutoCost * 1.5);
                updateUI(); saveGame();
            }
        });

        this.time.addEvent({ delay: 1000, callback: () => { score += autoClickRate; updateUI(); }, loop: true });
        updateUI();
    }

    function updateUI() {
        scoreText.setText(Math.floor(score));
        infoText.setText(`Ð¡Ð˜Ð›Ð Ð¢ÐÐŸÐ: ${clickPower}\nÐÐ’Ð¢Ðž-Ð¡Ð‘ÐžÐ : ${autoClickRate}/ÑÐµÐº`);
        txtClick.setText(`Ð£Ð›Ð£Ð§Ð¨Ð˜Ð¢Ð¬ Ð¢ÐÐŸ\nÐ¦ÐµÐ½Ð°: ${upgradeClickCost}`);
        txtAuto.setText(`ÐšÐ£ÐŸÐ˜Ð¢Ð¬ ÐÐ’Ð¢Ðž-Ð‘ÐžÐ¢Ð\nÐ¦ÐµÐ½Ð°: ${upgradeAutoCost}`);
    }

    function saveGame() {
        localStorage.setItem('cyberClickerSave', JSON.stringify({
            score, clickPower, autoClickRate, upgradeClickCost, upgradeAutoCost
        }));
    }

    function showClickText(scene, x, y, text) {
        const t = scene.add.text(x, y, text, { fontSize: '26px', fill: '#00ffcc', fontFamily: 'Arial Black' }).setOrigin(0.5).setStroke('#000', 4);
        scene.tweens.add({ targets: t, y: y - 100, alpha: 0, duration: 800, onComplete: () => t.destroy() });
    }
</script>
</body>
</html>
