<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
    </style>
</head>
<body>
<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let score = 0;
    let clickPower = 1;
    let autoClickRate = 0;
    let upgradeClickCost = 15;
    let upgradeAutoCost = 25;
    
    let scoreText, infoText, shopUI; // shopUI –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë –º–µ–Ω—é

    const config = {
        type: Phaser.AUTO,
        width: 400,
        height: 600,
        scene: { preload: preload, create: create }
    };

    const game = new Phaser.Game(config);

    function preload() {
        this.load.image('bg', 'bg.jpg');
        this.load.image('hero', 'soldier.png');
    }

    function create() {
        const scene = this;

        // –ó–∞–≥—Ä—É–∑–∫–∞
        const saved = localStorage.getItem('cyberSave');
        if(saved) {
            const d = JSON.parse(saved);
            score = d.score || 0;
            clickPower = d.clickPower || 1;
            autoClickRate = d.autoClickRate || 0;
            upgradeClickCost = d.upgradeClickCost || 15;
            upgradeAutoCost = d.upgradeAutoCost || 25;
        }

        // 1. –§–û–ù
        this.add.image(200, 300, 'bg').setDisplaySize(400, 600);

        // 2. –ì–ï–†–û–ô
        const hero = this.add.sprite(200, 350, 'hero').setInteractive();
        hero.setDisplaySize(250, 250);

        // 3. –¢–ï–ö–°–¢–´
        scoreText = this.add.text(20, 40, '', { fontSize: '45px', fill: '#fff', fontFamily: 'Arial Black' }).setStroke('#000', 8);
        infoText = this.add.text(20, 100, '', { fontSize: '18px', fill: '#00ffcc', fontFamily: 'Arial Black' }).setStroke('#000', 4);

        // –ö–õ–ò–ö
        hero.on('pointerdown', (pointer) => {
            if (shopUI) return; // –ï—Å–ª–∏ –º–∞–≥–∞–∑–∏–Ω –æ—Ç–∫—Ä—ã—Ç, –∫–ª–∏–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
            score += clickPower;
            updateUI();
            this.tweens.add({ targets: hero, scale: 0.8, duration: 50, yoyo: true });
            
            let t = this.add.text(pointer.x, pointer.y, `+${clickPower}`, { fontSize: '30px', fill: '#fff', fontFamily: 'Arial Black' });
            this.tweens.add({ targets: t, y: pointer.y - 100, alpha: 0, duration: 800, onComplete: () => t.destroy() });
            
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            saveGame();
        });

        // 4. –ö–ù–û–ü–ö–ê –ú–ê–ì–ê–ó–ò–ù–ê (–ü—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç-–∏–∫–æ–Ω–∫–∞, —á—Ç–æ–±—ã –Ω–∏—á—Ç–æ –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª–æ)
        const shopBtn = this.add.text(330, 40, 'üõí', { fontSize: '50px' }).setInteractive();
        
        shopBtn.on('pointerdown', () => {
            if (!shopUI) createShop(scene);
        });

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        function createShop(scene) {
            shopUI = scene.add.container(0, 0).setDepth(100);
            
            const bg = scene.add.rectangle(200, 300, 400, 600, 0x000000, 0.8).setInteractive();
            const win = scene.add.rectangle(200, 300, 300, 350, 0x222222).setStroke('#00ffcc', 2);
            const close = scene.add.text(320, 140, '‚úï', { fontSize: '35px', fill: '#fff' }).setInteractive();
            
            const b1 = scene.add.rectangle(200, 260, 250, 60, 0x333333).setInteractive();
            const t1 = scene.add.text(200, 260, `–¢–ê–ü: ${upgradeClickCost}`, { fontSize: '16px' }).setOrigin(0.5);

            const b2 = scene.add.rectangle(200, 340, 250, 60, 0x333333).setInteractive();
            const t2 = scene.add.text(200, 340, `–ê–í–¢–û: ${upgradeAutoCost}`, { fontSize: '16px' }).setOrigin(0.5);

            shopUI.add([bg, win, close, b1, t1, b2, t2]);

            close.on('pointerdown', () => { shopUI.destroy(); shopUI = null; });

            b1.on('pointerdown', () => {
                if (score >= upgradeClickCost) {
                    score -= upgradeClickCost; clickPower++; 
                    upgradeClickCost = Math.floor(upgradeClickCost * 1.8);
                    t1.setText(`–¢–ê–ü: ${upgradeClickCost}`); updateUI(); saveGame();
                }
            });

            b2.on('pointerdown', () => {
                if (score >= upgradeAutoCost) {
                    score -= upgradeAutoCost; autoClickRate++; 
                    upgradeAutoCost = Math.floor(upgradeAutoCost * 1.6);
                    t2.setText(`–ê–í–¢–û: ${upgradeAutoCost}`); updateUI(); saveGame();
                }
            });
        }

        // –ê–≤—Ç–æ–∫–ª–∏–∫
        this.time.addEvent({ delay: 1000, callback: () => { score += autoClickRate; updateUI(); }, loop: true });

        function updateUI() {
            scoreText.setText(Math.floor(score));
            infoText.setText(`–¢–ê–ü: +${clickPower} | –ê–í–¢–û: ${autoClickRate}/—Å`);
        }
        updateUI();
    }

    function saveGame() {
        localStorage.setItem('cyberSave', JSON.stringify({
            score, clickPower, autoClickRate, upgradeClickCost, upgradeAutoCost
        }));
    }
</script>
</body>
</html>
