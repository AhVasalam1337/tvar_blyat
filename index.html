<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background-color: #1a1a1a; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
    </style>
</head>
<body>
<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let score = 0;
    let clickPower = 1;
    let autoClickRate = 0;
    let upgradeClickCost = 15;
    let upgradeAutoCost = 25;
    let isShopOpen = false;

    let scoreText, infoText, txtClick, txtAuto;
    let shopGroup = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–æ–º

    const config = {
        type: Phaser.AUTO,
        width: 400,
        height: 600,
        backgroundColor: '#1a1a1a',
        scene: { preload: preload, create: create }
    };

    const game = new Phaser.Game(config);

    function preload() {
        // –ü—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ Imgur
        const proxy = "https://wsrv.nl/?url=";
        this.load.image('bg', proxy + "https://i.imgur.com/VbrseLE.jpeg");
        this.load.image('hero', proxy + "https://i.imgur.com/FObb0sw.png");
    }

    function create() {
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        const saved = localStorage.getItem('cyberClickerSave');
        if(saved) {
            const d = JSON.parse(saved);
            score = d.score || 0;
            clickPower = d.clickPower || 1;
            autoClickRate = d.autoClickRate || 0;
            upgradeClickCost = d.upgradeClickCost || 15;
            upgradeAutoCost = d.upgradeAutoCost || 25;
        }

        // 1. –§–û–ù
        if (this.textures.exists('bg')) {
            this.add.image(200, 300, 'bg').setDisplaySize(400, 600);
        }

        // 2. –ì–ï–†–û–ô
        const hero = this.add.sprite(200, 320, 'hero').setInteractive();
        if (this.textures.exists('hero')) {
            hero.setDisplaySize(250, 250);
        } else {
            hero.setTexture('__WHITE').setDisplaySize(150, 150).setTint(0x00ffcc);
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –≥–µ—Ä–æ—è
        this.tweens.add({ targets: hero, y: 340, duration: 2000, yoyo: true, repeat: -1, ease: 'Sine.easeInOut' });

        // 3. –¢–ï–ö–°–¢–´ (—Å–æ–∑–¥–∞–µ–º –ü–ï–†–ï–î –º–∞–≥–∞–∑–∏–Ω–æ–º, —á—Ç–æ–±—ã –æ–Ω–∏ –±—ã–ª–∏ –ø–æ–¥ –Ω–∏–º)
        scoreText = this.add.text(20, 25, '', { fontSize: '32px', fill: '#fff', fontFamily: 'Arial Black' }).setStroke('#000', 6);
        infoText = this.add.text(20, 75, '', { fontSize: '14px', fill: '#00ffcc', fontFamily: 'Arial' }).setStroke('#000', 4);

        // –ö–ª–∏–∫ –ø–æ –≥–µ—Ä–æ—é
        hero.on('pointerdown', (pointer) => {
            if (isShopOpen) return;
            score += clickPower;
            updateUI();
            this.tweens.add({ targets: hero, scale: 0.9, duration: 50, yoyo: true });
            showClickText(this, pointer.x, pointer.y, `+${clickPower}`);
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            saveGame();
        });

        // 4. –ö–ù–û–ü–ö–ê –ú–ê–ì–ê–ó–ò–ù–ê
        const shopBtn = this.add.rectangle(350, 50, 60, 60, 0x000000, 0.7).setInteractive();
        this.add.text(350, 50, 'üõí', { fontSize: '30px' }).setOrigin(0.5);

        // 5. –≠–õ–ï–ú–ï–ù–¢–´ –ú–ê–ì–ê–ó–ò–ù–ê (—Å–æ–∑–¥–∞–µ–º –∏ –°–†–ê–ó–£ –ø—Ä—è—á–µ–º)
        const overlay = this.add.rectangle(200, 300, 400, 600, 0x000000, 0.8).setInteractive().setVisible(false);
        const menuBg = this.add.rectangle(200, 300, 320, 350, 0x1a1a1a).setStroke('#00ffcc', 2).setVisible(false);
        const closeBtn = this.add.text(330, 140, '‚úï', { fontSize: '32px', fill: '#fff' }).setInteractive().setVisible(false);
        
        const btn1 = this.add.rectangle(200, 260, 280, 60, 0x333333).setInteractive().setStroke('#3498db', 2).setVisible(false);
        txtClick = this.add.text(200, 260, '', { fontSize: '14px', fill: '#fff' }).setOrigin(0.5).setVisible(false);

        const btn2 = this.add.rectangle(200, 340, 280, 60, 0x333333).setInteractive().setStroke('#2ecc71', 2).setVisible(false);
        txtAuto = this.add.text(200, 340, '', { fontSize: '14px', fill: '#fff' }).setOrigin(0.5).setVisible(false);

        shopGroup = [overlay, menuBg, closeBtn, btn1, txtClick, btn2, txtAuto];

        // –õ–æ–≥–∏–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞
        shopBtn.on('pointer
